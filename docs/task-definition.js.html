<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: task-definition.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: task-definition.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
* @author Rafael Vidaurre
* @module TaskDefinition
* @requires Utils
*/

'use strict';

var _, utils, Task;

_ = require('lodash');
utils = require('./utils');
Task = require('./task');

/**
* @class
*/
function TaskDefinition (id) {
  this.id = id;

  /**
  * List of function which modify the Task definition's configuration (provided by config())
  */
  this._configCallbacks = [];

  /**
  * Task definition's configuration object (set by running all configCallback functions)
  * Property names are pre-defined just for maintainability
  * @private
  */
  this._config = {
    hooks: {
      onFail: null,
      onSuccess: null
    }
  };

  /**
  * The main method of the TaskDefinition
  * @private
  */
  this._main = null;

  /**
  * Set of hooks for the task, defined at setup time
  * @private
  */
  this._hooks = {};

  /**
  * TaskDefinition's builder method, by default will instantiate the task once with empty parameters
  * @private
  */
  this._builder = function () {
    return {};
  };
}

/**
* Executes the builder function and builds the Task instances
* Note: This is called by the job
* @private
* @return {array} An array of Task instances
*/
TaskDefinition.prototype._build = function (builderParams, cookieJar, job) {
  var _this, paramSets, tasks, task;

  _this = this;

  if (!_.isFunction(this._main)) {
    throw new Error('Cannot build task with no main method set');
  }

  tasks = [];
  paramSets = utils.arrayify(this._builder(builderParams));

  _.each(paramSets, function (paramSet) {
    task = new Task(_this.id, _this._main, paramSet, cookieJar, _this._config, job);
    tasks.push(task);
  });

  return tasks;
};

/**
* Applies the current task setup
* @private
*/
TaskDefinition.prototype._applySetup = function () {
  if (this._applied) {
    return;
  }

  this._applyConfigCallbacks();
  this._applied = true;
};

/**
* Run functions passed via config(), thus applying their config logic
* @private
*/
TaskDefinition.prototype._applyConfigCallbacks = function () {
  var _this = this;

  _.each(_this._configCallbacks, function (configCallback) {
    configCallback(_this._config);
  });
};

/**
* Sets main task's method
* @param {function} mainMethod main task method, this contains the scraping logic that makes a task
* unique
*/
TaskDefinition.prototype.main = function (mainMethod) {
  if (!_.isFunction(mainMethod)) {
    throw new Error('Main method must be a function');
  }

  this._main = mainMethod;

  return this;
};

/**
* Sets the task's builder method overriding its default building behaviour
* @param {function} builderMethod method which defines task's building logic, if the builder returns
* an array, the task will be instanced once for every element in the array, passing each element in
* it as a parameter to its corresponding task
*/
TaskDefinition.prototype.builder = function (builderMethod) {
  if (!_.isFunction(builderMethod)) {
    throw new Error('Builder must be a function');
  }

  this._builder = builderMethod;

  return this;
};

/**
* Saves a configuration function into the config callbacks array
* @param {function} cbConfig method which modifies the Task definition's config object (passed as
* argument)
*/
TaskDefinition.prototype.setup = function (cbConfig) {
  if (!_.isFunction(cbConfig)) {
    throw new Error('Setup argument must be a function');
  }

  this._configCallbacks.push(cbConfig);

  return this;
};

module.exports = TaskDefinition;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Agent.html">Agent</a></li><li><a href="module-Http.html">Http</a></li><li><a href="module-Job.html">Job</a></li><li><a href="module-Options.html">Options</a></li><li><a href="module-Scraper.html">Scraper</a></li><li><a href="module-Task.html">Task</a></li><li><a href="module-TaskDefinition.html">TaskDefinition</a></li><li><a href="module-Utils.html">Utils</a></li><li><a href="module-Yakuza.html">Yakuza</a></li><li><a href="module-YakuzaBase.html">YakuzaBase</a></li></ul><h3>Classes</h3><ul><li><a href="module-Agent-Agent.html">Agent</a></li><li><a href="module-Http-Http.html">Http</a></li><li><a href="module-Job-Job.html">Job</a></li><li><a href="module-Options-Options.html">Options</a></li><li><a href="module-Scraper-Scraper.html">Scraper</a></li><li><a href="module-TaskDefinition-TaskDefinition.html">TaskDefinition</a></li><li><a href="module-Task-Task.html">Task</a></li><li><a href="module-YakuzaBase-YakuzaBase.html">YakuzaBase</a></li></ul><h3>Global</h3><ul><li><a href="global.html#defaults">defaults</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-beta2</a> on Wed Mar 11 2015 18:10:11 GMT-0300 (CLST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
