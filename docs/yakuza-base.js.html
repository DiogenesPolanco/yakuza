<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: yakuza-base.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: yakuza-base.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
* @module YakuzaBase
* @author Rafael Vidaurre
* @requires Utils
* @requires Scraper
* @requires Job
*/

'use strict';

var shortId, utils, _, Scraper, Job;

shortId = require('shortid');
utils = require('./utils');
_ = require('lodash');
Scraper = require('./scraper');
Job = require('./job');

/**
* Main singleton class used to define scrapers and their properties
* @class
*/
function YakuzaBase () {
  /**
  * Set of scraper instances
  * @private
  */
  this._scrapers = {};

  /**
  * Set of job instances
  * @private
  */
  this._jobs = {};
}

/**
* Creates a new scraper instance
* @param {string} scraperId name to be asigned to the created scraper
* @return {Scraper} scraper created
* @private
*/
YakuzaBase.prototype._createScraper = function (scraperId) {
  this._scrapers[scraperId] = new Scraper();
  return this._scrapers[scraperId];
};

/**
* Returns a scraper instance, if it doesn't exist, it creates it
* @param {string} scraperId name for the new scraper or by which to look for if it exists
* @return {Scraper} scraper instance
*/
YakuzaBase.prototype.scraper = function (scraperId) {
  var thisScraper, scraperExists;

  scraperExists = utils.hasKey(this._scrapers, scraperId);
  thisScraper = scraperExists ? this._scrapers[scraperId] : this._createScraper(scraperId);

  return thisScraper;
};

/**
* Returns an agent instance, if it doesn't exists, it creates it
* @param {string} scraperId name of the scraper to which the agent belongs to
* @param {string} agentId name of the new agent or by which to look for if it exists
* @return {Agent} agent instance
*/
YakuzaBase.prototype.agent = function (scraperId, agentId) {
  return this.scraper(scraperId).agent(agentId);
};

YakuzaBase.prototype.task = function (scraperId, agentId, taskId) {
  return this.agent(scraperId, agentId).task(taskId);
};

/**
* Instances a new job
* @param {string} scraperId name of the scraper that will be used by the Job
* @param {string} agentId name of the agent that will be used by the Job
* @return {Job} Job instance that has been created
*/
YakuzaBase.prototype.job = function (scraperId, agentId, params) {
  var newId, scraper, agent, newJob;

  if (!scraperId) {
    throw new Error('Scraper id must be passed');
  }

  if (!agentId) {
    throw new Error('Agent id must be passed');
  }

  if (params &amp;&amp; !_.isObject(params)) {
    throw new Error('Params passed must be an object');
  }

  scraper = this._scrapers[scraperId];
  agent = scraper._agents[agentId];
  newId = shortId.generate();
  newJob = new Job(newId, scraper, agent, params);
  this._jobs[newId] = newJob;

  return newJob;
};

/**
* Applies all configurations for all scrapers and agents, Yakuza can eager-load (via this
* method) or lazy-load (by running a job).
*/
YakuzaBase.prototype.ready = function () {
  _.each(this._scrapers, function (scraper) {
    scraper._applySetup();
    _.each(scraper._agents, function (agent) {
      agent._applySetup();
    });
  });
};

module.exports = YakuzaBase;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Agent.html">Agent</a></li><li><a href="module-Http.html">Http</a></li><li><a href="module-Job.html">Job</a></li><li><a href="module-Options.html">Options</a></li><li><a href="module-Scraper.html">Scraper</a></li><li><a href="module-Task.html">Task</a></li><li><a href="module-TaskDefinition.html">TaskDefinition</a></li><li><a href="module-Utils.html">Utils</a></li><li><a href="module-Yakuza.html">Yakuza</a></li><li><a href="module-YakuzaBase.html">YakuzaBase</a></li></ul><h3>Classes</h3><ul><li><a href="module-Agent-Agent.html">Agent</a></li><li><a href="module-Http-Http.html">Http</a></li><li><a href="module-Job-Job.html">Job</a></li><li><a href="module-Options-Options.html">Options</a></li><li><a href="module-Scraper-Scraper.html">Scraper</a></li><li><a href="module-TaskDefinition-TaskDefinition.html">TaskDefinition</a></li><li><a href="module-Task-Task.html">Task</a></li><li><a href="module-YakuzaBase-YakuzaBase.html">YakuzaBase</a></li></ul><h3>Global</h3><ul><li><a href="global.html#defaults">defaults</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-beta2</a> on Wed Mar 11 2015 18:10:11 GMT-0300 (CLST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
